---
id: Set_Develop_Env
title: 设置开发环境
sidebar_label: 设置开发环境
---

本文档主要是针对在PlatON区块链上构建应用程序的开发人员的入门指南。从这里开始，了解在PlatON上构建应用程序的含义以及如何快速部署个人私有区块链。 

- `PlatON`支持Windows和Ubuntu下进行源码编译安装。
- 私链部署方法以Ubuntu为例，包括单节点和集群部署，Windows上的部署方法和Ubuntu类似。

## Windows源码编译

Windows编译环境需要符合以下条件：

- git：`2.19.1以上`
- go语言开发包：`go(1.7+)`
- mingw：`mingw（V8.1.0）`
- cmake: `3.0+`

可自行安装以上编译环境，在编译`PlatON`源码之前请确保以上环境可正常运行。

> 也可使用`Chocolatey`辅助安装编译环境（如果你还没有`chocolatey`，可以按照<https://chocolatey.org>上的说明进行安装），用管理员身份启动`PowerShell`，然后执行以下命令：
>
> 安装git：
>
> ```
> choco install git
> ```
>
> 安装golang：
>
> ```
> choco install golang
> ```
>
> 安装mingw：
>
> ```
> choco install mingw
> ```
>
> 安装cmake：
>
> ```
> choco install cmake
> ```
>
> 利用`chocolatey`包管理器安装的软件大部分有默认的安装路径，部分软件可能会有各种各样的路径，这取决于软件的发布者。安装这些包将修改Path环境变量。最后安装路径可查看PATH，某些机器环境可能在 PATH 中找不到这些工具的安装路径，此时需手动添加。安装完之后请确保已安装的Go版本为1.7（或更高版本）。
>
> 例如：安装cmake之后，在CMD命令行中键入cmake，如果提示找不到该命令，则需要在path中添加cmake安装的路径。

- 获取源码

在当前`%GOPATH%`目录下创建`src/github.com/PlatONnetwork/`和`bin`目录，在`PlatONnetwork`目录下克隆`PlatON-GO`的源码，其中`release-0.10.0`为分支名称，届时切换到实际的分支：

```
cd src/github.com/PlatONnetwork/;
git clone -b release-0.10.0 https://github.com/PlatONnetwork/PlatON-Go.git --recursive
```

- 编译

> 以下编译命令均需在`Git-bash`环境运行， 且步骤1中编译环境都已经成功安装！

进入源码目录`PlatON-Go`：

```
cd PlatON-Go
```

在编译源码目录之前在源码目录`PlatON-Go`下执行以下脚本编译所需依赖库：

```
./build/build_deps.sh
```

由于编译依赖bls库，需要把PlatON-Go\crypto\bls\bls_win\lib配置到系统的path环境变量里面,
否则会报`exit status 3221225781`错误。

在源码目录`PlatON-Go`下执行以下编译命令可生成`platon`、`keytool`可执行文件，如下：

```
go run build/ci.go install ./cmd/platon
go run build/ci.go install ./cmd/keytool
```

编译完成之后在`PlatON-Go/build/bin`目录下会生成`platon`、`keytool`可执行文件，将这两个可执行文件拷贝到自己工作目录运行即可。

> 重复编译会覆盖之前生成的可执行文件。

## Ubuntu源码编译

**step1.** 安装编译环境（Ubuntu）：

- 系统版本：`Ubuntu 18.04.1 及以上`
- git：`2.19.1及以上`
- 编译器：`gcc(4.9.2+)`、`g++(5.0+)`
- go语言开发包：`go(1.7+)`
- cmake:`3.0+`

**step2.** 获取PlatON源码：

```bash
git clone -b release-0.10.0 https://github.com/PlatONnetwork/PlatON-Go.git --recursive
```

**step3.** 安装依赖库：

```bash
sudo apt update && sudo apt install golang-go cmake llvm g++ libgmp-dev libssl-dev
```

**step4.** 编译：

```bash
cd PlatON-Go && make all
```

编译完成之后在`./build/bin`目录下会生成`platon, keytool`等一系列可执行文件。

**step5.** 拷贝二进制： 

```shell
sudo cp -f ./build/bin/platon /usr/bin/ && sudo cp -f ./build/bin/keytool /usr/bin/
```

## 搭建私链

如果你不方便连接到外部网络，也可以选择搭建自己的私有网络。`PlatON`支持单节点模式和集群模式运行私有网络。以Ubuntu环境为例，假设节点数据目录为：`~/platon-node/data` (用户可自行调整)，进行说明：

### 单节点

- **生成nodekey和blskey等相关文件**

```shell
mkdir -p ~/platon-node/data && keytool genkeypair | tee >(grep "PrivateKey" | awk '{print $2}' > ~/platon-node/data/nodekey) >(grep "PublicKey" | awk '{print $3}' > ~/platon-node/data/nodeid) && keytool genblskeypair | tee >(grep "PrivateKey" | awk '{print $2}' > ~/platon-node/data/blskey) >(grep "PublicKey" | awk '{print $3}' > ~/platon-node/data/blspub)
```

>说明：
>
>- nodeid：节点公钥(ID）文件，保存节点的公钥，用于标识节点身份
>- nodekey：节点私钥文件，保存节点的私钥，不能公开并且需要做好备份。
>- blspub：节点BLS公钥文件，保存节点的BLS公钥，用于共识协议中快速验证签名。
>- blskey：节点BLS私钥文件，保存节点的BLS私钥，不能公开并且需要做好备份。

- **生成创世块配置文件`platon.json`**

在~/platon-node目录下创建创世区块配置文件platon.json，然后将以下的创世区块配置文件模板内容拷贝到platon.json文件中，修改 `your-node-pubkey` 为之前生成的***节点公钥(nodekey)***，`your-node-blspubkey` 为 ***节点bls公钥(blspub)***，`your-account-address`为钱包地址：

```json
{
	"config": {
		"chainId": 299,
		"eip155Block": 1,
		"VMInterpreter": "evm",
		"cbft": {
			"initialNodes": [{
				"node": "enode://your-node-pubkey@127.0.0.1:16789",
				"blsPubKey": "your-node-blspubkey"
			}],
			"amount": 10,
			"period": 20000,
			"validatorMode": "ppos"
		},
		"genesisVersion": 2304
	},
	"economicModel": {
		"common": {
			"maxEpochMinutes": 360,
			"maxConsensusVals": 25,
			"additionalCycleTime": 525960
		},
		"staking": {
			"stakeThreshold": 1000000000000000000000000,
			"operatingThreshold": 10000000000000000000,
			"maxValidators": 101,
			"unStakeFreezeDuration": 28
		},
		"slashing": {
			"slashFractionDuplicateSign": 10,
			"duplicateSignReportReward": 50,
			"maxEvidenceAge": 27,
			"slashBlocksReward": 0
		},
		"gov": {
			"versionProposalVoteDurationSeconds": 1209600,
			"versionProposalSupportRate": 0.667,
			"textProposalVoteDurationSeconds": 1209600,
			"textProposalVoteRate": 0.5,
			"textProposalSupportRate": 0.667,
			"cancelProposalVoteRate": 0.50,
			"cancelProposalSupportRate": 0.667,
			"paramProposalVoteDurationSeconds": 1209600,
			"paramProposalVoteRate": 0.50,
			"paramProposalSupportRate": 0.667
		},
		"reward": {
			"newBlockRate": 50,
			"platonFoundationYear": 10
		},
		"innerAcc": {
			"platonFundAccount": "0xBE0af016941Acaf08Bf5f4ad185155Df6B7388ce",
			"platonFundBalance": 0,
			"cdfAccount": "0x08b2320Ef2482f0a5ad9411CCB1a748BcE7c2823",
			"cdfBalance": 331811981000000000000000000
		}
	},
	"nonce": "0x0376e56dffd12ab53bb149bda4e0cbce2b6aabe4cccc0df0b5a39e12977a2fcd23",
	"timestamp": "0x5bc94a8a",
	"extraData": "0xd782070186706c61746f6e86676f312e3131856c696e757800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
	"gasLimit": "4712388",
	"alloc": {
		"1000000000000000000000000000000000000003": {
			"balance": "200000000000000000000000000"
		},
		"your-account-address": {
		  "balance": "999000000000000000000"
		}
	},
	"number": "0x0",
	"gasUsed": "0x0",
	"parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000"
}
```

- **初始化创世区块**

```shell
cd ~/platon-node && platon --datadir ./data init platon.json
```

>说明：
>
>出现`Successfully wrote genesis state`相关提示说明初始化创世信息完成。

- **启动节点**

  一般情况下，platon 进程一直在前台进行，这样我们就不能进行其他操作了，并且如果中途退出该终端，程序将退出。Ubuntu下可以以nohup方式启动程序：

```shell
cd ~/platon-node && nohup platon --identity "platon" --datadir ./data --port 16789 --rpcaddr 127.0.0.1 --rpcport 6789 --rpcapi "db,platon,net,web3,admin,personal" --rpc --nodiscover --nodekey ./data/nodekey --cbft.blskey ./data/blskey & > ./data/platon.log 2>&1 &
```

当shell中提示nohup成功后再按下一次回车，确保不会因为误关闭终端引起进程退出。

- **检查节点运行状态**

```shell
platon attach http://localhost:6789 --exec platon.blockNumber
```

多执行几次上面的命令，如果块高一直在增长，表示单节点私链部署成功。

### PlatON 集群环境

`PlatON集群`是有多节点参与的网络环境，这里我们假设你已经可以构建PlatON单节点。并且，我们将在一台服务器构建两个节点组成的网络。更多的节点在操作流程上类似。

为了在本地运行PlatON多节点，你要确保：

- 每个节点实例拥有单独的data目录（--datadir）
- 每个实例运行在不同的端口上，不管是p2p端口还是rpc端口（--port and --rpcport ）
- 节点可以彼此互连
- RPC服务器端口不被占用

**1.创建目录**

在platon-node目录下创建目录data0和data1，作为两个节点的数据目录。分别生成两个节点的coinbase账户。

```shell
mkdir -p ~/platon-node/data0 ~/platon-node/data1
```

**2.生成密钥对**

分别将2个节点的nodekey和blskey保存到'data0'和'data1'

```shell
cd ~/platon-node/data0 && keytool genkeypair | tee >(grep "PrivateKey" | awk '{print $2}' > ./nodekey) >(grep "PublicKey" | awk '{print $3}' > ./nodeid) && keytool genblskeypair | tee >(grep "PrivateKey" | awk '{print $2}' > ./blskey) >(grep "PublicKey" | awk '{print $3}' > ./blspub)

cd ~/platon-node/data1 && keytool genkeypair | tee >(grep "PrivateKey" | awk '{print $2}' > ./nodekey) >(grep "PublicKey" | awk '{print $3}' > ./nodeid) && keytool genblskeypair | tee >(grep "PrivateKey" | awk '{print $2}' > ./blskey) >(grep "PublicKey" | awk '{print $3}' > ./blspub)
```

**3.编辑创世文件**

修改创世块配置文件`platon.json`。

将两个节点的节点信息加入 **initialNodes** 数组中，因为我们生成的是两个节点组成的集群环境，所以数组长度为2。
需要修改`platon.json`文件：
请将以下文件内容'node0-nodekey'、'node1-nodekey'、'node0-blspubkey'和'node1-blspubkey'分别替换为上一步生成的节点公钥和节点bls公钥。
'your-account-address'替换为钱包地址。

```
……
  "cbft": {
  "initialNodes": [{
		"node": "enode://node0-pubkey@127.0.0.1:16789",
		"blsPubKey": "node0-blspubkey"
	},{
		"node": "enode://node1-pubkey@127.0.0.1:16790",
		"blsPubKey": "node1-blspubkey"
	}],
	……
  "alloc": {
    "your-account-address": {
      	"balance": "999000000000000000000"
    },
    "1000000000000000000000000000000000000003": {
		"balance": "200000000000000000000000000"
	}
  },
……
```

**4.初始化和启动**

分别为节点0和节点1初始化创世块信息：

```
platon --datadir ~/platon-node/data0 init platon.json && platon --datadir ~/platon-node/data1 init platon.json
```

初始化成功后，分别用nohup方式启动节点0和节点1：

```shell
cd ~/platon-node && nohup platon --identity "platon0" --datadir ./data0 --port 16789 --rpcaddr 0.0.0.0 --rpcport 6789 --rpcapi "db,platon,net,web3,admin,personal" --rpc --nodiscover --nodekey ./data0/nodekey --cbft.blskey ./data0/blskey > ./data0/platon.log 2>&1 &

cd ~/platon-node && nohup platon --identity "platon1" --datadir ./data1 --port 16790 --rpcaddr 0.0.0.0 --rpcport 6790 --rpcapi "db,platon,net,web3,admin,personal" --rpc --nodiscover --nodekey ./data1/nodekey --cbft.blskey ./data1/blskey  > ./data1/platon.log 2>&1 &
```

**5.检查**

通过前面所述的方式进入任意一个节点platon控制台，查看节点是否和对端建立连接以及通过查看blockNumber是否在持续增长来判断集群是否已成功启动。

```shell
platon attach http://localhost:6789 --exec platon.blockNumber
platon attach http://localhost:6790 --exec platon.blockNumber
```

多执行几次，观察块高的增长情况。